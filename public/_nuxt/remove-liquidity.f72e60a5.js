import{_ as Po}from"./back.fd4ae9d3.js";import{_ as Bo}from"./coin-pair-name.04a357ce.js";import{_ as Lo}from"./status-block.0ca976a3.js";import{_ as Uo,a as Do}from"./swap-setting.7868fc9b.js";import{a as jo,Z as Oo,r as l,e as Eo,i as T,b as Vo,$ as Wo,W as Mo,f4 as Fo,w as G,fj as Xo,ad as uo,Q as w,x as zo,fk as ho,fl as Go,B as ro,L as bo,z as ko,A as Ko,j as K,k as Qo,o as A,l as q,E as P,m as e,t as n,q as mo,c as _o,p as oo,G as go,T as wo,C as B,F as Zo,N as Ho,O as Jo,I as Yo,fm as xo,K as oe,s as ee,v as ne,U as se}from"./entry.12ef1f17.js";import{p as co}from"./precision.ce0280e5.js";const ie=jo({setup(){const{t:o,locale:r}=Oo();let vo=l(!1),M=l(!1);const Q=l(!1),po=()=>{J(),Q.value=!0,setTimeout(()=>{Q.value=!1},1e3)},no=[{name:"25%",value:25},{name:"50%",value:50},{name:"75%",value:75},{name:"MAX",value:100}],F=Eo(),I=T(()=>F),so=Vo(),L=l(""),U=l(""),D=l(""),Z=l(""),H=l(""),t=l(""),j=l(""),io=l(""),yo=i=>{let u=i.replace(/[^\d.]/g,"");const d=/^\d+(\.\d+)?$/;u.split(".").length>2&&!d.exec(u)&&(u=u.substr(0,u.length-1)),k.value=u},a=T(()=>so),h=l({}),b=l({}),s=l(a.value.currentPositionInfo||{}),Ao=Wo(),X=T(()=>Ao),S=Mo();Fo(()=>{X.value.connected||S.push("/position")});const N=T(()=>I.value.chainName?Ko(I.value.chainName):{}),J=async()=>{a.value.setCurrentPositionLoading(!0);const i=S.currentRoute.value.query.token||"",u=S.currentRoute.value.query.collect||"",d=S.currentRoute.value.query.pos||"";I.value.chainName==="Aptos"?i&&u&&(L.value=u,U.value=S.currentRoute.value.query.address,D.value=i,a.value.setCurrentPositionInfo(U.value,L.value,D.value,I.value.chainName),s.value=a.value.currentPositionInfo):d&&(L.value=u,U.value=S.currentRoute.value.query.address,D.value=i,a.value.setCurrentPositionInfo(U.value,L.value,D.value,I.value.chainName,d),s.value=a.value.currentPositionInfo)};G(()=>a.value.addressLpTokens,i=>{K(i)||J()},{immediate:!0}),G(()=>a.value.currentPositionInfo,i=>{i&&(s.value=a.value.currentPositionInfo,h.value=s.value.token_a,b.value=s.value.token_b,lo({value:k.value/100}),console.log(s.value,"  positionInfo.valuepositionInfo.value"))});const k=l(50),c=l(0),f=l(0),to=l(0),ao=T(()=>F.slippage);G(k,Xo((i,u)=>{Number(i)>100?k.value=100:i&&s.value&&(k.value=i,lo({value:k.value/100}))},300)),G(ao,i=>{i&&s.value&&lo({value:k.value/100})});const lo=i=>{var x,z;const u=s.value.token_a.decimals,d=s.value.token_b.decimals,R=s.value.tick_lower_index,$=s.value.tick_upper_index,v=ho.tickIndexToSqrtPriceX64(R),_=ho.tickIndexToSqrtPriceX64($);to.value=s.value.liquidity*Number(i.value);const y=Go.getCoinAmountFromLiquidity(new ro(to.value),new ro(s.value.current_sqrt_price),v,_,!0),p=Number(y.coinA.toString())/Math.pow(10,u),g=Number(y.coinB.toString())/Math.pow(10,d);console.log(p,g,"amountA121212"),c.value=p,f.value=g;const m=(x=a.value.RATES[s.value.token_a.address])==null?void 0:x.price,O=(z=a.value.RATES[s.value.token_b.address])==null?void 0:z.price;console.log(c.value,m,"fromCoinAmount.value"),Z.value=Number(c.value*m)<.01?Number(c.value*m)===0?"0":"<0.01":w(c.value*m,2),H.value=Number(f.value*O)<.01?Number(f.value*O)===0?"0":"<0.01":w(f.value*O,2);const E=co.minus(Number(s.value.amountA),Number(c.value))*m;t.value=Number(E)<.01?Number(E)===0?"0":"<0.01":w(E,2);const V=co.minus(Number(s.value.amountB),Number(f.value))*O;j.value=Number(V)<.01?Number(V)===0?"0":"<0.01":w(V,2);const W=Number(bo(E,2))+Number(bo(V,2));io.value=Number(W)<.01?Number(W)===0?"0":"<0.01":w(W,2)},{setIsShowSuccess:No,setIsShowRejected:fo,setIsShowWaiting:Y,setTransactionDesc:$o,setTransactionTxid:Io,setPositiomNum:ln,setTransactionDescText:So}=F,Co=async()=>{var u,d,R,$;M.value=!0,Io(""),$o(o("tips.removeLiquidiyText",{from:w(c.value,h.value.decimals)==0?"":`${uo(c.value,h.value.decimals)} ${h.value.symbol}`,and:w(c.value,h.value.decimals)==0||w(f.value,b.value.decimals)==0?"":"and",to:w(f.value,b.value.decimals)==0?"":`${uo(f.value,b.value.decimals)} ${b.value.symbol}`})),Y(!0);const i=C.value&&C.value.length>0?o("modal.removeLiquidityText1"):o("modal.removeLiquidityText2");So(i);try{let v={};v={pool:{...s.value.poolInfo,coinA:s.value.token_a,coinB:s.value.token_b},coinTypeA:s.value.poolInfo.coinTypeA,coinTypeB:s.value.poolInfo.coinTypeB,position:s.value,delta_liquidity:new ro(ko(to.value,0)),slippage:Number(ao.value),rewards_num:C.value.length};const _=C.value;console.log(C,"===>pendingRewarderArr"),v.coinTypeC=_[0]?_[0].coin_address:"",v.coinTypeD=_[1]?_[1].coin_address:"",v.coinTypeE=_[2]?_[2].coin_address:"",console.log(v,"===>params");const y=await N.value.getRemoveLiquidityTransactionPayload(v);let p;if(I.value.chainName==="Aptos")p=await X.value.currentWallet.signAndSubmitTransaction(y);else{const g=await X.value.currentWallet.signAndExecuteTransaction(y);p=N.value.handleTx(g)}if(p&&p.hash){Io(p.hash),Y(!1),No(!0);const g={title:o("common.removeLiquidity"),desc:"",hash:p.hash,descTransactions:`Remove ${c.value} ${(u=h.value)==null?void 0:u.symbol} and ${f.value} ${(d=b.value)==null?void 0:d.symbol} 
             from the pool`,sender:X.value.address,chainName:I.value.chainName,tit:`${k.value==100?"Closed":"Modified"} Position: ${s.value.poolInfo.symbol}`,text:`Withdraw ${c.value} ${(R=h.value)==null?void 0:R.symbol} and ${f.value} ${($=b.value)==null?void 0:$.symbol}`};N.value.showTransitionPending(g),await N.value.watchTransaction(g)&&(setTimeout(()=>{J()},3e3),setTimeout(()=>{J()},6e3),Number(k.value)==100&&S.push("/position"))}else Y(!1),fo(!0);M.value=!1}catch(v){console.log("Remove error",v),M.value=!1,Y(!1),fo(!0)}},Ro=T(()=>a.value.tokensObj&&h.value.address&&a.value.tokensObj[h.value.address]&&a.value.tokensObj[h.value.address].logoURI),To=T(()=>a.value.tokensObj&&b.value.address&&a.value.tokensObj[b.value.address]&&a.value.tokensObj[b.value.address].logoURI),qo=l(0),C=l([]);return G(()=>[s.value,a.value.addressLpTokens,a.value.newTokenObj,a.value.RATES],async([i,u,d,R])=>{if(!K(i)&&!K(u)&&!K(d)&&!K(R)){const $=u[i.poolAddress];console.log($,"===>pool");const v=await N.value.getTickDataByIndex($.ticks_handle,Number(i.tick_lower_index)),_=await N.value.getTickDataByIndex($.ticks_handle,Number(i.tick_upper_index));let y={};I.value.chainName==="Aptos"?y=await N.value.getPosRewardersAmount({poolAddress:i.poolAddress,positionName:i.tokenName,tickLowerData:v,tickUpperData:_}):y=await N.value.getPosRewardersAmount({poolAddress:i.poolAddress,pos:i.pos_object_id});const p=[];let g=0;y.forEach((m,O)=>{if(s.value.poolInfo[`rewarder_display${O+1}`]){const E=d[m.coin_address].decimals,V=d[m.coin_address];console.log(m.amount_owed.toString(),"===>element.amount_owed.toString()");const W=Number(m.amount_owed.toString())/Math.pow(10,E),x=R[d[m.coin_address].name.toUpperCase()].price,z=W*x;g+=z,p.push({...m,...V,amount:W,amountUSD:z})}}),C.value=p,qo.value=Number(ko(g,2))}},{immediate:!0}),{removeAmountARates:t,removeAmountBRates:j,removeAmountRates:io,receiveAmountARates:Z,receiveAmountBRates:H,showNum:uo,fromCoinUrl:Ro,toCoinUrl:To,precision:co,addCommom:w,loading:M,wallet:X,toRemove:Co,fromCoinAmount:c,toCoinAmount:f,pools:a,refresh:Q,amountArr:no,sliderVal:k,positionInfo:s,slippage:ao,importIcon:zo,clickRefresh:po,isShowSwapSetting:vo,pendingRewarderArr:C,changeValue:yo}}});const eo=o=>(ee("data-v-a0a58f5f"),o=o(),ne(),o),te={class:"remove-liquidity"},ae={class:"remove-liquidity-top"},le={class:"remove-title"},ue={class:"right title-right"},re=eo(()=>e("svg",{class:"icon","aria-hidden":"true"},[e("use",{"xlink:href":"#icon-a-icon-setslippage"})],-1)),de=eo(()=>e("use",{"xlink:href":"#icon-icon-refresh"},null,-1)),me=[de],ce={class:"remove-liquidity-center"},ve={class:"top"},pe={class:"left"},fe={class:"right"},Ie={class:"fee"},he={class:"bottom"},be={class:"add-amount"},ke={class:"add-amount-header"},_e={class:"amount-list"},ge=["onClick"],we={class:"slider-box"},ye={class:"receive"},Ae={class:"receiveTit"},Ne={class:"item"},$e={class:"left"},Se=["src"],Ce={class:"right"},Re={class:"item"},Te={class:"left"},qe=["src"],Pe={class:"right"},Be={class:"remove-liquidity-bottom-box"},Le={class:"induction remove-liquidity-bottom"},Ue={class:"item"},De={class:"induction-text"},je={class:"induction-value"},Oe=["src"],Ee=eo(()=>e("div",{class:"induction-text"},null,-1)),Ve={class:"induction-value"},We=["src"],Me={class:"induction-text"},Fe={class:"induction-value"},Xe=["src"],ze=eo(()=>e("svg",{"aria-hidden":"true"},[e("use",{"xlink:href":"#icon-icon-Remove"})],-1)),Ge={key:0,class:"receive"},Ke={class:"receiveTit"},Qe={class:"left"},Ze={class:"right"},He={class:"item"},Je={class:"left"},Ye=["src"],xe={class:"right"},on={class:"item"},en={class:"left"},nn=["src"],sn={class:"right"},tn={class:"loading-global"};function an(o,r,vo,M,Q,po){const no=Po,F=Bo,I=Lo,so=Yo,L=xo,U=oe,D=Do,Z=Uo,H=se;return A(),q("div",te,[P(no),e("div",ae,[e("div",le,n(o.$t("common.removeLiquidity")),1),e("div",ue,[e("div",{class:"slippage-icon",onClick:r[0]||(r[0]=t=>o.isShowSwapSetting=!0)},[re,e("span",null,n(o.slippage)+"%",1)]),(A(),q("svg",{"aria-hidden":"true",class:mo(o.refresh?"refresh refresh-icon ":"refresh-icon"),onClick:r[1]||(r[1]=(...t)=>o.clickRefresh&&o.clickRefresh(...t))},me,2))])]),e("div",ce,[e("div",ve,[e("div",pe,[o.positionInfo?(A(),_o(F,{key:0,"from-coin":o.positionInfo.token_a,"to-coin":o.positionInfo.token_b},null,8,["from-coin","to-coin"])):oo("",!0),e("div",fe,[e("div",Ie,n(o.positionInfo.fee*100)+"%",1)])]),P(I,{"current-status":o.positionInfo.currentStatus||""},null,8,["current-status"])]),e("div",he,[e("div",be,[e("div",ke,[e("span",null,n(o.$t("common.amount")),1),e("div",_e,[(A(!0),q(go,null,wo(o.amountArr,(t,j)=>(A(),q("div",{key:j,class:mo(["amount-item",o.sliderVal==t.value?"amount-item-active":""]),onClick:io=>o.sliderVal=t.value},n(t.name),11,ge))),128))])]),e("div",we,[P(so,{value:o.sliderVal,"onUpdate:value":r[2]||(r[2]=t=>o.sliderVal=t),suffix:"%",onChange:r[3]||(r[3]=t=>o.changeValue(t.target.value))},null,8,["value"]),P(L,{value:o.sliderVal,"onUpdate:value":r[4]||(r[4]=t=>o.sliderVal=t)},null,8,["value"])])])])]),e("div",ye,[e("div",Ae,n(o.$t("newAdd.receive")),1),e("div",Ne,[e("div",$e,[e("img",{src:o.fromCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol.toLowerCase()}.png`)},null,8,Se),e("span",null,n(o.showNum(o.fromCoinAmount,o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.decimals)),1),B(" "+n(o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol)+" "+n(o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.labels&&o.positionInfo.token_a.labels[0]?`(${o.positionInfo.token_a.labels[0]})`:""),1)]),e("div",Ce,"\u2248 $"+n(o.receiveAmountARates),1)]),e("div",Re,[e("div",Te,[e("img",{src:o.toCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol.toLowerCase()}.png`)},null,8,qe),e("span",null,n(o.showNum(o.toCoinAmount,o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.decimals)),1),B(" "+n(o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol)+" "+n(o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.labels&&o.positionInfo.token_b.labels[0]?`(${o.positionInfo.token_b.labels[0]})`:""),1)]),e("div",Pe,"\u2248 $"+n(o.receiveAmountBRates),1)])]),e("div",Be,[e("div",Le,[e("div",Ue,[e("div",De,n(o.$t("common.fees")),1),e("div",je,[e("img",{src:o.fromCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol.toLowerCase()}.png`)},null,8,Oe),B(" "+n(o.showNum(o.positionInfo&&o.positionInfo.feeOwedA,o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.decimals))+" ",1),e("span",null,n(o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol),1)])]),e("div",{class:mo(o.pendingRewarderArr.length>0?"item item-boder":"item")},[Ee,e("div",Ve,[e("img",{src:o.toCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol.toLowerCase()}.png`)},null,8,We),B(" "+n(o.showNum(o.positionInfo&&o.positionInfo.feeOwedB,o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.decimals))+" ",1),e("span",null,n(o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol),1)])],2),o.positionInfo.is_display_rewarder?(A(!0),q(go,{key:0},wo(o.pendingRewarderArr,(t,j)=>(A(),q("div",{key:t,class:"item"},[e("div",Me,n(j==0?o.$t("common.rewards"):""),1),e("div",Fe,[e("img",{src:t.logoURI},null,8,Xe),B(" "+n(t.amount>1e-6?t.amount:t.amount===0?"0":"<0.000001")+" ",1),e("span",null,n(t.symbol),1)])]))),128)):oo("",!0)])]),P(U,{disabled:o.wallet.connected?Number(o.sliderVal)==0||o.loading:!1,class:"remove-btn big-btn",onClick:r[5]||(r[5]=t=>o.wallet.connected?o.toRemove():o.wallet.setIsShowWalletModal(!0))},{default:Zo(()=>[ze,e("span",null,n(o.wallet.connected?o.$t("button.remove"):o.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),P(D),o.sliderVal<100?(A(),q("div",Ge,[e("div",Ke,[e("div",Qe,n(o.$t("newAdd.remainingPosition")),1),e("div",Ze,"$"+n(o.removeAmountRates),1)]),e("div",He,[e("div",Je,[e("img",{src:o.fromCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol.toLowerCase()}.png`)},null,8,Ye),e("span",null,n(o.showNum(o.precision.minus(Number(o.positionInfo.amountA),Number(o.fromCoinAmount)),o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.decimals)),1),B(" "+n(o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.symbol)+" "+n(o.positionInfo&&o.positionInfo.token_a&&o.positionInfo.token_a.labels&&o.positionInfo.token_a.labels[0]?`(${o.positionInfo.token_a.labels[0]})`:""),1)]),e("div",xe,"\u2248 $"+n(o.removeAmountARates),1)]),e("div",on,[e("div",en,[e("img",{src:o.toCoinUrl||o.importIcon(`/image/coins/${o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol.toLowerCase()}.png`)},null,8,nn),e("span",null,n(o.showNum(o.precision.minus(Number(o.positionInfo.amountB),Number(o.toCoinAmount)),o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.decimals)),1),B(" "+n(o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.symbol)+" "+n(o.positionInfo&&o.positionInfo.token_b&&o.positionInfo.token_b.labels&&o.positionInfo.token_b.labels[0]?`(${o.positionInfo.token_b.labels[0]})`:""),1)]),e("div",sn,"\u2248 $"+n(o.removeAmountBRates),1)])])):oo("",!0),o.isShowSwapSetting?(A(),_o(Z,{key:1,onOnClose:r[6]||(r[6]=t=>o.isShowSwapSetting=!1)})):oo("",!0),Ho(e("div",tn,[P(H)],512),[[Jo,o.pools.currentPositionLoading]])])}const pn=Qo(ie,[["render",an],["__scopeId","data-v-a0a58f5f"]]);export{pn as default};
